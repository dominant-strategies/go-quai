# Support setting various labels on the final image
ARG COMMIT=""
ARG VERSION=""
ARG BUILDNUM=""

# Build Quai in a stock Go builder container
FROM golang:1.20-alpine as builder
RUN apk add --no-cache gcc musl-dev linux-headers git
ADD . /go-quai
WORKDIR /go-quai
RUN env GO111MODULE=on go run build/ci.go install ./cmd/go-quai

# Stage 2
FROM golang:1.20-alpine

# Prime
EXPOSE 10001 10002 10000 10000/udp

# Region
EXPOSE 10004 10005 10003 10003/udp
EXPOSE 10007 10008 10006 10006/udp
EXPOSE 10010 10011 10009 10009/udp
EXPOSE 10013 10014 10012 10012/udp

# Zone
EXPOSE 10052 10053 10051 10051/udp
EXPOSE 10055 10056 10054 10054/udp
EXPOSE 10058 10059 10057 10057/udp
EXPOSE 10061 10062 10060 10060/udp
EXPOSE 10064 10065 10063 10063/udp
EXPOSE 10067 10068 10066 10066/udp
EXPOSE 10070 10071 10069 10069/udp
EXPOSE 10073 10074 10072 10072/udp
EXPOSE 10076 10077 10075 10075/udp
EXPOSE 10079 10080 10078 10078/udp
EXPOSE 10082 10083 10081 10081/udp
EXPOSE 10085 10086 10084 10084/udp
EXPOSE 10088 10089 10087 10087/udp
EXPOSE 10091 10092 10090 10090/udp
EXPOSE 10094 10095 10093 10093/udp
EXPOSE 10097 10098 10096 10096/udp

COPY --from=builder /go-quai/build/bin ./build/bin
COPY --from=builder /go-quai/VERSION ./VERSION
COPY --from=builder /go-quai/genallocs ./genallocs
WORKDIR ./